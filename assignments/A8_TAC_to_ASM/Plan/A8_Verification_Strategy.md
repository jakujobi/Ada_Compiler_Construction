# Assignment 8 Requirements Plan

**Goal:** To create a Python program (`ASMGenerator`) that reads a `.tac` file (generated by the A7 compiler extended with I/O) and outputs a functional 8086 `.asm` file that can be assembled with MASM/TASM and run in DOSBox, correctly implementing the program logic including assignments, arithmetic, procedure calls, and I/O.

## Core Requirements & Verification Strategy

| ID      | Requirement Description                                                                                                                                                                                     | Verification Strategy                                                                                                                                                                                                                                                                                          |
| :------ | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **R1**  | **Input TAC Parsing:** System must correctly parse input `.tac` lines into components (label, opcode, operands).                                                                                            | Create diverse test `.tac` files. Use internal logging/debugging within the `ASMGenerator` to print parsed components for each line and manually verify correctness against the input `.tac` file.                                                                                                             |
| **R2**  | **ASM File Generation:** System must generate a text file with the specified `.asm` output filename.                                                                                                        | Run the `ASMGenerator`. Check that the `.asm` file is created in the expected directory with the correct name.                                                                                                                                                                                                 |
| **R3**  | **Standard ASM Boilerplate:** Generated `.asm` must include `.model small`, `.586`, `.stack 100h`, and `END main_label`.                                                                                    | Manually inspect the beginning and end of generated `.asm` files. Assemble the file with MASM/TASM to confirm these directives are syntactically correct.                                                                                                                                                      |
| **R4**  | **`.data` Section Generation:** Generate a correct `.data` section.                                                                                                                                         |                                                                                                                                                                                                                                                                                                                |
| R4.1    | Define global variables (depth 1) using `DW ?`.                                                                                                                                                             | Use test TAC with global variables. Inspect `.data` section for correct `VarName DW ?` entries. Assemble.                                                                                                                                                                                                      |
| R4.2    | Define string literals (from `wrs` TAC) using unique labels and `DB "string", '$'`.                                                                                                                         | Use test TAC with `wrs` instructions. Inspect `.data` section for correct `_SLabel DB "string", '$'` entries. Assemble.                                                                                                                                                                                        |
| **R5**  | **`.code` Section & `io.asm` Inclusion:** Generate `.code` section directive and `include io.asm`.                                                                                                          | Manually inspect generated `.asm`. Assemble using MASM/TASM, ensuring `io.asm` is present in the directory, to verify successful inclusion without errors.                                                                                                                                                     |
| **R6**  | **`main` Entry Point Procedure:** Generate the required `main PROC`/`ENDP` block, initializing `DS`, calling the user's main procedure (from `start` TAC directive), and using `int 21h` for DOS exit.      | Inspect generated `.asm`. Assemble & link. Run Test Case 1 (or a simple equivalent) in DOSBox. Verify program execution starts, calls the correct user procedure, and terminates cleanly via DOS exit.                                                                                                         |
| **R7**  | **Procedure Translation (`proc`/`endp`):** Translate `proc Name` / `endp Name` TAC into `Name PROC` / `Name ENDP` blocks.                                                                                   | Use test TAC with multiple nested/sequential procedures. Inspect generated `.asm` for correctly labeled and matched `PROC`/`ENDP` blocks.                                                                                                                                                                      |
| **R8**  | **Procedure Prologue/Epilogue:** Generate correct prologue (`push bp; mov bp, sp; sub sp, SizeOfLocals`) and epilogue (`add sp, SizeOfLocals; pop bp; ret SizeOfParams`) using sizes from the symbol table. | Requires Symbol Table integration. Manually inspect prologues/epilogues in generated `.asm` for several procedures with varying numbers of locals/params. Verify `sub sp` and `ret N` values match symbol table data. Execute tests involving procedure calls to ensure stack pointer is correctly maintained. |
| **R9**  | **Operand Addressing:** Generate correct assembly addressing modes based on operand type and symbol table info.                                                                                             |                                                                                                                                                                                                                                                                                                                |
| R9.1    | Access globals (depth 1) by name.                                                                                                                                                                           | Test TAC using global variables as source/destination. Inspect `.asm` for direct name usage (e.g., `mov ax, myGlobal`). Run and verify correct values.                                                                                                                                                         |
| R9.2    | Access locals/params/temps (depth >= 2) via `[bp+/-offset]`.                                                                                                                                                | Test TAC using stack variables. Inspect `.asm` for correct `[bp-X]` (locals/temps) and `[bp+X]` (params) usage. Run and verify correct values.                                                                                                                                                                 |
| R9.3    | Use immediate values directly.                                                                                                                                                                              | Test TAC assigning immediate values (e.g., `t1 = 10`). Inspect `.asm` for correct immediate usage (e.g., `mov ax, 10`).                                                                                                                                                                                        |
| R9.4    | Access string literals via `OFFSET label`.                                                                                                                                                                  | Test TAC using `wrs`. Inspect `.asm` for `mov dx, OFFSET _SLabel` usage.                                                                                                                                                                                                                                       |
| **R10** | **TAC Assignment Translation (`=`):** Correctly translate assignment TAC.                                                                                                                                   | Test assignments between all valid operand type combinations (global, local, temp, immediate). Inspect `.asm` for correct `mov` sequences (using `AX` as intermediary if needed). Run tests and verify outcomes.                                                                                               |
| **R11** | **TAC Arithmetic Translation (`+`, `*`):** Correctly translate arithmetic TAC using intermediary registers.                                                                                                 | Test `+` and `*` TAC with various operand types. Inspect `.asm` for correct sequences (e.g., `mov ax, op1; add/imul reg, op2; mov dest, ax`). Run tests and verify computed results.                                                                                                                           |
| **R12** | **TAC Procedure Call Translation (`call`):** Translate `call ProcName` TAC to `call ProcName` assembly.                                                                                                     | Use test TAC with procedure calls. Inspect `.asm` for `call Label`. Run and verify control transfer.                                                                                                                                                                                                           |
| **R13** | **Pass-by-Value Translation (`push`):** Translate `push VarValue` TAC for value parameters correctly.                                                                                                       | Use Test Case 3 (or similar with value params). Inspect `.asm` for `push value` before `call`. Verify callee accesses via `[bp+N]` and uses `ret N`. Run test and verify parameter value is received correctly.                                                                                                |
| **R14** | **Pass-by-Reference Translation (`push @`):** Translate `push @VarAddress` TAC and handle dereferencing.                                                                                                    | Use Test Case 5 (or similar with ref params). Verify caller uses `push offset Var`. Verify callee fetches address to `BX` (`mov bx, [bp+N]`), modifies via `[bx]`, uses `ret N`. Run test and verify caller variable is modified.                                                                              |
| **R15** | **I/O TAC Translation:** Translate `wrs`, `wri`, `rdi`, `wrln` to correct `io.asm` calls with register setup.                                                                                               |                                                                                                                                                                                                                                                                                                                |
| R15.1   | Translate `wrs Label`.                                                                                                                                                                                      | Use Test Case 2 (or similar). Inspect `.asm` for `mov dx, offset Label; call writestr`. Run and verify string output.                                                                                                                                                                                          |
| R15.2   | Translate `wri Address`.                                                                                                                                                                                    | Use Test Cases 1, 2 (or similar). Inspect `.asm` for `mov REG, Address; call writeint` (verifying REG from `io.asm`). Run and verify integer output.                                                                                                                                                           |
| R15.3   | Translate `rdi Address`.                                                                                                                                                                                    | Use Test Cases 2, 4, 5 (or similar). Inspect `.asm` for `call readint; mov Address, bx`. Run, provide input, and verify the variable at `Address` is updated correctly.                                                                                                                                        |
| R15.4   | Translate `wrln`.                                                                                                                                                                                           | Use Test Case 2 (or similar). Inspect `.asm` for `call writeln`. Run and verify newline output occurs.                                                                                                                                                                                                         |
| **R16** | **MASM Compatibility:** Generated `.asm` must assemble without errors using MASM/TASM.                                                                                                                      | Assemble all generated `.asm` files from test cases using MASM in DOSBox. Resolve any reported assembly errors.                                                                                                                                                                                                |
| **R17** | **DOSBox Execution:** Assembled `.exe` must run correctly within DOSBox and produce expected results/behavior.                                                                                              | Execute all assembled test cases in DOSBox. Compare program output and behavior against expected results based on the source/TAC logic.                                                                                                                                                                        |
| **R18** | **Variable `C` Renaming:** Handle potential MASM conflict by renaming variables named `c`.                                                                                                                  | Create/use test TAC involving a variable named `c`. Inspect generated `.asm` to ensure the name is altered (e.g., `cc DW ?`). Assemble and run to confirm no errors related to the identifier `c`.                                                                                                             |

---